{% extends "herobase/layout/base.html" %}
{% load url from future %}
{% load i18n hero_actions hero_message static %}

{% block content %}
  <div class="quest-detail">
    <div class="text">
      <span>Details zu</span>
      <h1>{{ quest.title }}</h1>
      <p>{{ quest.description|linebreaksbr|urlize }}</p>
    </div>
    <div class="sidebar">
      <div class="data">
        <dl>
          <dt>Ersteller:</dt>
          <dd>
            <a href="{% url "userprofile_public" quest.owner.username %}">
              {{ quest.owner.username }}
            </a>
          </dd>

          <dt>Status:</dt><dd>{{ quest.get_state_display }}</dd>
          <dt>Gesuchte Helden</dt><dd>{{ quest.max_heroes }}</dd>
          <dt>Erstellt am:</dt><dd>{{ quest.created.date }}</dd>
          <dt>LÃ¤uft noch bis:</dt><dd>{{ quest.expiration_date.date }}</dd>
        </dl>
        {% include "herobase/quest/quest_box_footer.html" %}
      </div>
      {% if is_owner %}
        {% if not quest.edit_window_expired %}
            <a class="box-button" href="{% url "quest_update" quest.pk %}" data-toggle="tooltip" data-title="Bearbeiten"><i class="icon-pencil"></i></a>
        {% endif %}
        {% if quest.open %}

        <form method="post" action="{% url "owner_update_quest" quest.pk %}">
            {% csrf_token %}
            <input type="hidden" name="action" value="cancel">
            <button class="box-button" type="submit" value="cancel" name="cancel"  data-toggle="tooltip" data-title="Quest Abbrechen">
                <i class="icon-trash"></i>
            </button>
        </form>
        {% endif %}

        {% if quest.can_start %}
        <form method="post" action="{% url "owner_update_quest" quest.pk %}">
          {% csrf_token %}
          <input type="hidden" name="action" value="start">
          <button class="box-button" type="submit" value="start" name="start" data-toggle="tooltip" data-title="Quest Start">
            <i class="icon-ok"></i>
          </button>
        </form>
        {% elif quest.started and not quest.done %}
            <form method="post" action="{% url "owner_update_quest" quest.pk %}">
                {% csrf_token %}
                <input type="hidden" name="action" value="done">
                <button class="box-button" type="submit" value="start" name="start" data-toggle="tooltip" data-title="Quest als erledigt markieren">
                    <i class="icon-ok"></i>
                </button>
            </form>
        {% endif %}
      {% else %}
        {% if user.is_authenticated %}
        <form id="hero-cancel" method="POST" action="{% url "hero_update_quest" quest.pk %}">
            {% csrf_token %}
            {% if request_user_adventure and not quest.canceled and not request_user_adventure.rejected %}
              <input type="hidden" name="action" value="cancel">
              <button class="box-button" type="submit" name="action_btn" value="{% trans "Cancel" %}" data-toggle="tooltip" data-title="Abbrechen">
                  <i class="icon-remove"></i>
              </button>
            {% endif %}
        </form>
        {% endif %}
        {% message_user quest.owner %}
        {% if not request_user_adventure and not quest.has_expired %}
            {% if user.is_authenticated %}
                <form class="hfill" method="POST" action="{% url "hero_update_quest" quest.pk %}">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="apply">
                    <button class="box-button text" type="submit" name="action_btn">
                        <span>{% trans "Apply" %}</span>
                    </button>
                </form>
            {% else %}
                <a  class="box-button text hfill" href="{% url 'auth_login' %}?next={{ quest_url }}">
                    <span>{% trans "Apply" %}</span>
                </a>
            {% endif %}
        {% endif %}
      {% endif %}
      </div>
    </div>

    {% if is_owner %}
        {% include "herobase/quest/adventures_box_owner.html" %}
    {% else %}
        {% include "herobase/quest/adventures_box_hero.html" %}
    {% endif %}
    {% include "herobase/quest/comments_box.html" %}
{% endblock %}
