{% extends "herobase/layout-3-6-3.html" %}
{% load i18n hero_actions hero_message static %}
{% block javascript %}
    <script type="text/javascript" src="{% get_static_prefix %}js/forms.js"></script>
    <script>
        $(function() {
            confirm_button("input[name=action_btn]");
        });
    </script>
{% endblock %}

{% block submenu %}
    {% include "herobase/quest/submenu.inc.html"%}
{% endblock %}

{% block content %}
    <div class="quest-detail well quest-class-{{ quest.hero_class }}">
        <div class="page-header">
            <h1>{{ quest.title }}
            <small>
                {{ quest.get_hero_class_display }}
                <div class="charicon {{ quest.get_hero_class_display }}"/>
            </small>
            </h1>
        </div>
        <div class="well">{{ quest.description }}</div>

        <div class="row-fluid">
            <div class="span6">
                <dl class="dl-horizontal">
                        <dt>{% trans "Author" %}</dt><dd><a href="{% url userprofile-public quest.owner.username %}">{{ quest.owner }}</a>{% message_user quest.owner %}</dd>
                    <dt>{% trans "Location" %}</dt><dd>{{ quest.location }}</dd>
                </dl>
            </div>
            <div class="span6">
                <dl class="dl-horizontal">
                    <dt>{% trans "Level" %}</dt><dd>{{ quest.level }}</dd>
                    <dt>{% trans "Experience" %}</dt><dd>{{ quest.experience }}</dd>
                </dl>
            </div>
        </div>

        {# Owner #}
        {% if request.user == quest.owner %}
            <h2>Du bist der Auftraggeber</h2>
            {% if quest.is_active %}
                {% if not quest.heroes.exists %}
                    <p>Dies ist Dein Quest. Sobald ein Held Dir helfen möchte siehst Du unten eine Liste mit Deinen Helden</p>
                {% else %}
                    {% if quest.applying_heroes.exists %}
                        <p>Hey, es gibt Helden die Dir helfen möchten! Akzeptiere einen Held und er wird Dir helfen.
                            Wenn Dir ein Held nicht geheuer ist, kannst Du ihn auch zurückweisen.</p>
                    {% endif %}
                    {% if quest.active_heroes.exists %}
                        {% if not quest.is_full %}
                            <p>Du hast schon {{ quest.active_heroes.count }} Held{{ quest.active_heroes.count|pluralize:" der dir hilft,en die Dir helfen" }}.
                            Noch {{ quest.remaining_slots }} Held{{ quest.remaining_slots|pluralize:" kann,en können" }} teilnehmen.</p>
                        {% else %}
                            <p>Dir {{ quest.max_heroes|pluralize:"hilft,helfen" }} {{ quest.max_heroes }} Held{{ quest.max_heroes|pluralize:"en" }}. Deine Quest ist voll.</p>
                        {% endif %}
                        <p>Wenn Du die Quest abschließt, kannst Du die Teilnahme Deiner Helden bestätigen und somit Erfahrungspunkte verteilen :-) </p>
                        <p><strong>Achtung:</strong> An einer abgeschlossenen Quest können keine weiteren Helden teilnehmen.</p>
                    {% endif %}
                {% endif %}
                <p>Für abgebrochene Quests bekommt niemand Erfahrungspunkte. Eine abgebrochene Quest kann nicht wieder aufgenommen werden.</p>
            {% else %}
                {% if quest.is_canceled %}
                    <p>Du hast diese Quest abgebrochen. Niemand bekommt Erfahrungspunkte :-(</p>
                {% elif quest.is_done %}
                    <p>Diese Quest is abgeschlossen. Verteile nun Erfahrungspunkte an alle Helden die Dir geholfen haben
                        indem Du die Teilnahme bestätigst.</p>
                {% endif %}
            {% endif %}
        {% elif quest.is_canceled %}
            <h2>Abgebrochen</h2>
            <p>Der Auftraggeber
                (<a href="{% url userprofile-public quest.owner.username %}">{{ quest.owner }}</a>)
                hat diese Quest leider abgebrochen.</p>

        {# Hero #}
        {% elif adventure %}
            {% if adventure.state == adventure.STATE_HERO_APPLIED %}
                <h2>Du hast Dich beworben</h2>
                <p>Du hast Dich für diese Quest beworben. Sobald der Auftraggeber
                    (<a href="{% url userprofile-public quest.owner.username %}">{{ quest.owner }}</a>)
                    Dich akzeptiert, kann es losgehen.</p>
                <p>Wenn Dir etwas dazwischengekommen ist, kannst Du die Quest auch abbrechen.</p>
            {% elif adventure.state == adventure.STATE_OWNER_REFUSED %}
                <h2>Zurückgewiesen</h2>
                <p>Schade. Der Auftraggeber
                    (<a href="{% url userprofile-public quest.owner.username %}">{{ quest.owner }}</a>)
                    hat Dich zurückgewiesen. Aber nicht verzagen, vielleicht war die Quest einfach schon voll.</p>
            {% elif adventure.state == adventure.STATE_HERO_CANCELED %}
                <h2>Abgebrochen</h2>
                <p>Du hast diese Quest abgebrochen. Wenn Du möchtest, kannst Du Dich wieder bewerben.</p>
            {% elif adventure.state == adventure.STATE_OWNER_ACCEPTED %}
                <h2>Du nimmst teil</h2>
                <p>Du nimmst an dieser Quest teil und der Auftraggeber
                    (<a href="{% url userprofile-public quest.owner.username %}">{{ quest.owner }}</a>)
                    hat dich akzeptiert.</p>
                <p>Jetzt solltest Du zur Tat schreiten!</p>
                <p>Wenn Dir etwas dazwischengekommen ist, kannst Du die Quest auch abbrechen.</p>
            {% elif adventure.state == adventure.STATE_HERO_DONE %}
                <h2>Du nimmst teil</h2>
                <p>Du nimmst an dieser Quest teil und hast dem Auftraggeber
                    (<a href="{% url userprofile-public quest.owner.username %}">{{ quest.owner }}</a>)
                    mitgeteilt, dass Du die Quest erledigt hast.</p>
                <p>Jetzt muss der Auftraggeber Deine Teilnahme nur noch bestätigen und Du bekommst Erfahrungspunkte.</p>
            {% elif adventure.state == adventure.STATE_OWNER_DONE %}
                <h2>Erfolgreich abgeschlossen</h2>
                <p>Du hast an dieser Quest teilgenommen und Deinen Heldenmut bewiesen.</p>
                <p>Du hast {{ quest.experience }} Erfahrungspunkte erhalten.</p>
            {% endif %}
        {% elif quest.is_done %}
            <h2>Abgeschlossen</h2>
            <p>Diese Quest ist schon abgeschlossen. Es ist keine Teilnahme möglich.</p>
        {% elif quest.is_full %}
            <h2>Voll</h2>
            <p>Diese Quest ist leider schon voll. Es ist keine Teilnahme möglich.</p>
        {% else %}
            <h2>Helden gesucht</h2>
            <p>Diese Herausforderung braucht noch Helden. Wenn Dir die Beschreibung zusagt, kannst Du Dich bewerben.</p>
        {% endif %}

        {# quest actions #}
        {% valid_actions_for quest as valid_actions %}
        {% if valid_actions %}
            <div class="form-actions">
            {% for action_name, action in valid_actions.items %}
                <form action="{% url quest-update quest.id %}" method="post" class="inline">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="{{ action_name }}">
                    <input type="submit" name="action_btn" class="btn" value="{{ action.verbose_name }}"/>
                </form>
            {% endfor %}
            </div>
        {% endif %}
<table><tr><td><a name="fb_share"></a></td><td><a href="https://twitter.com/share" class="twitter-share-button" data-size="small" data-hashtags="yah!" data-count="none">Tweet</a>
</td><td><g:plusone size="medium" annotation="none"></g:plusone></td><td><div id="diaspora" style="width: 153px;height:30px;background:url('{% get_static_prefix %}img/icons/diaspora-share.png') no-repeat left top; background-position:0px 0px;" onClick="javascript:(function(){f='https://joindiaspora.com/bookmarklet?url='+encodeURIComponent(window.location.href)+'&title='+encodeURIComponent('Shared a link...')+'¬es='+encodeURIComponent(document.title)+'&v=1&';if(!window.open(f+'noui=1&jump=doclose','diasporav1','location=no,links=no,scrollbars=no,toolbar=no,width=620,height=400')){location.href=f+'jump=yes'; 
document.getElementById('diaspora').style.backgroundPosition = '0 -90px';}else{document.getElementById('diaspora').style.backgroundPosition = '0 -60px';}})()"> </div></td></tr></table>
<!-- Platzieren Sie diese Render-Anweisung an einer geeigneten Stelle. -->
<script type="text/javascript">
  (function() {
    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    po.src = 'https://apis.google.com/js/plusone.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  })();
</script>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script> 
<script src="https://static.ak.fbcdn.net/connect.php/js/FB.Share" 
        type="text/javascript">
</script>
        {# owner #}
        {% if request.user == quest.owner %}
            {% include "herobase/quest/adventures.inc.html" %}
        {% endif %}
    </div>
{% endblock %}
